defmodule Cron.CalcTest do
  use ExUnit.Case, async: true

  import Prove

  alias Cron.Calc

  require Logger

  batch "next/2" do
    prove next("* * * * * *", ~N[2021-11-07 09:10:05]) == ~N[2021-11-07 09:10:06]
    prove next("* * * * * *", ~N[2000-12-31 23:59:59]) == ~N[2001-01-01 00:00:00]

    prove next("10 * * * * *", ~N[2000-01-01 00:00:00]) == ~N[2000-01-01 00:00:10]
    prove next("10 * * * * *", ~N[2000-01-01 00:00:10]) == ~N[2000-01-01 00:01:10]
    prove next("10 * * * * *", ~N[2000-01-01 00:00:20]) == ~N[2000-01-01 00:01:10]
    prove next("10 * * * * *", ~N[1999-12-31 23:59:59]) == ~N[2000-01-01 00:00:10]

    prove next("59 * * * * *", ~N[1999-12-31 23:59:59]) == ~N[2000-01-01 00:00:59]

    prove next("*/23 * * * * *", ~N[2021-01-01 00:00:00]) == ~N[2021-01-01 00:00:23]
    prove next("*/23 * * * * *", ~N[2021-01-01 00:00:23]) == ~N[2021-01-01 00:00:46]
    prove next("*/23 * * * * *", ~N[2021-01-01 00:00:46]) == ~N[2021-01-01 00:01:00]

    prove next("*/30 */2 * * * *", ~N[2021-01-01 00:00:59]) == ~N[2021-01-01 00:02:00]
    prove next("*/30 */2 * * * *", ~N[2021-01-01 00:02:00]) == ~N[2021-01-01 00:02:30]
    prove next("*/30 */2 * * * *", ~N[2021-01-01 00:02:30]) == ~N[2021-01-01 00:04:00]
    prove next("*/30 */2 * * * *", ~N[2021-01-01 00:04:00]) == ~N[2021-01-01 00:04:30]

    prove next("0 10 * * * *", ~N[2000-01-01 00:00:00]) == ~N[2000-01-01 00:10:00]
    prove next("0 10 * * * *", ~N[2022-01-31 23:30:00]) == ~N[2022-02-01 00:10:00]
    prove next("0 10 * * * *", ~N[2022-02-01 00:10:00]) == ~N[2022-02-01 01:10:00]
    prove next("0 10 * * * *", ~N[2000-01-01 00:15:59]) == ~N[2000-01-01 01:10:00]
    prove next("0 10 * * * *", ~N[2000-12-31 23:10:00]) == ~N[2001-01-01 00:10:00]

    prove next("59 10 * * * *", ~N[2000-01-01 00:00:00]) == ~N[2000-01-01 00:10:59]
    prove next("59 10 * * * *", ~N[2000-01-01 00:10:59]) == ~N[2000-01-01 01:10:59]

    prove next("0 15,40 * * * *", ~N[2021-11-05 09:10:00]) == ~N[2021-11-05 09:15:00]
    prove next("0 15,40 * * * *", ~N[2021-11-05 09:15:00]) == ~N[2021-11-05 09:40:00]
    prove next("0 15,40 * * * *", ~N[2021-11-05 09:15:01]) == ~N[2021-11-05 09:40:00]
    prove next("0 15,40 * * * *", ~N[2021-11-05 09:16:00]) == ~N[2021-11-05 09:40:00]
    prove next("0 15,40 * * * *", ~N[2021-11-05 09:45:00]) == ~N[2021-11-05 10:15:00]
    prove next("0 15,40 * * * *", ~N[2021-11-05 23:55:00]) == ~N[2021-11-06 00:15:00]

    prove next("0 40,15 * * * *", ~N[2021-11-05 09:10:00]) == ~N[2021-11-05 09:15:00]
    prove next("0 40,15 * * * *", ~N[2021-11-05 09:15:00]) == ~N[2021-11-05 09:40:00]
    prove next("0 40,15 * * * *", ~N[2021-11-05 09:15:01]) == ~N[2021-11-05 09:40:00]
    prove next("0 40,15 * * * *", ~N[2021-11-05 09:16:00]) == ~N[2021-11-05 09:40:00]
    prove next("0 40,15 * * * *", ~N[2021-11-05 09:45:00]) == ~N[2021-11-05 10:15:00]
    prove next("0 40,15 * * * *", ~N[2021-11-05 23:55:00]) == ~N[2021-11-06 00:15:00]

    prove next("0 15-20,10 * * * *", ~N[2021-11-05 23:55:00]) == ~N[2021-11-06 00:10:00]
    prove next("0 15-20,10 * * * *", ~N[2021-11-06 10:10:00]) == ~N[2021-11-06 10:15:00]

    prove next("0 15-20,20/2,1-15/3 * * * *", ~N[2021-11-05 23:55:00]) == ~N[2021-11-05 23:56:00]

    prove next("0 15-20,1-15/3,*/4 * * * *", ~N[2021-11-05 23:55:00]) == ~N[2021-11-05 23:56:00]

    prove next("0 */3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 12:03:00]
    prove next("0 */3 * * * *", ~N[2021-11-05 12:03:00]) == ~N[2021-11-05 12:06:00]
    prove next("0 */3 * * * *", ~N[2021-11-05 12:04:00]) == ~N[2021-11-05 12:06:00]
    prove next("0 */3 * * * *", ~N[2021-11-05 12:59:00]) == ~N[2021-11-05 13:00:00]

    prove next("0 20-30/3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 12:20:00]
    prove next("0 20-30/3 * * * *", ~N[2021-11-05 12:20:00]) == ~N[2021-11-05 12:23:00]
    prove next("0 20-30/3 * * * *", ~N[2021-11-05 12:24:00]) == ~N[2021-11-05 12:26:00]
    prove next("0 20-30/3 * * * *", ~N[2021-11-05 12:28:00]) == ~N[2021-11-05 12:29:00]
    prove next("0 20-30/3 * * * *", ~N[2021-11-05 12:30:00]) == ~N[2021-11-05 13:20:00]

    prove next("0 2/3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 12:02:00]
    prove next("0 2/3 * * * *", ~N[2021-11-05 12:03:00]) == ~N[2021-11-05 12:05:00]
    prove next("0 2/3 * * * *", ~N[2021-11-05 12:05:00]) == ~N[2021-11-05 12:08:00]
    prove next("0 2/3 * * * *", ~N[2021-11-05 12:07:00]) == ~N[2021-11-05 12:08:00]
    prove next("0 2/3 * * * *", ~N[2021-11-05 12:08:00]) == ~N[2021-11-05 12:11:00]
    prove next("0 2/3 * * * *", ~N[2021-11-05 12:59:59]) == ~N[2021-11-05 13:02:00]

    prove next("0 10-20 * * * *", ~N[2021-11-05 11:01:00]) == ~N[2021-11-05 11:10:00]
    prove next("0 10-20 * * * *", ~N[2021-11-05 11:12:00]) == ~N[2021-11-05 11:13:00]
    prove next("0 10-20 * * * *", ~N[2021-11-05 11:55:33]) == ~N[2021-11-05 12:10:00]

    prove next("* * 10 * * *", ~N[2021-11-07 09:05:00]) == ~N[2021-11-07 10:00:00]
    prove next("* * 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-07 10:10:01]
    prove next("* * 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-08 10:00:00]

    prove next("0 * 10 * * *", ~N[2021-11-07 09:10:00]) == ~N[2021-11-07 10:00:00]
    prove next("0 * 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-07 10:11:00]
    prove next("0 * 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-08 10:00:00]

    prove next("0 0 10 * * *", ~N[2021-11-07 09:10:00]) == ~N[2021-11-07 10:00:00]
    prove next("0 0 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-08 10:00:00]
    prove next("0 0 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-08 10:00:00]

    prove next("* * 1,22 * * *", ~N[2021-11-13 00:00:00]) == ~N[2021-11-13 01:00:00]
    prove next("* * 1,22 * * *", ~N[2021-11-13 01:00:10]) == ~N[2021-11-13 01:00:11]
    prove next("* * 1,22 * * *", ~N[2021-11-13 01:33:22]) == ~N[2021-11-13 01:33:23]
    prove next("* * 1,22 * * *", ~N[2021-11-13 02:00:00]) == ~N[2021-11-13 22:00:00]

    prove next("0 * 1,22 * * *", ~N[2021-11-13 00:00:00]) == ~N[2021-11-13 01:00:00]
    prove next("0 * 1,22 * * *", ~N[2021-11-13 01:00:10]) == ~N[2021-11-13 01:01:00]
    prove next("0 * 1,22 * * *", ~N[2021-11-13 02:00:00]) == ~N[2021-11-13 22:00:00]
    prove next("0 * 1,22 * * *", ~N[2021-11-13 23:00:00]) == ~N[2021-11-14 01:00:00]

    prove next("0 0 5,22 * * *", ~N[2021-11-13 00:00:00]) == ~N[2021-11-13 05:00:00]
    prove next("0 0 5,22 * * *", ~N[2021-11-13 05:00:00]) == ~N[2021-11-13 22:00:00]
    prove next("0 0 5,22 * * *", ~N[2021-11-13 05:10:00]) == ~N[2021-11-13 22:00:00]
    prove next("0 0 5,22 * * *", ~N[2021-11-13 23:00:00]) == ~N[2021-11-14 05:00:00]

    prove next("* * * 10 * *", ~N[2021-11-01 23:00:00]) == ~N[2021-11-10 00:00:00]
    prove next("* * * 10 * *", ~N[2021-11-11 23:00:00]) == ~N[2021-12-10 00:00:00]
    prove next("* * * 10 * *", ~N[2021-12-11 23:00:00]) == ~N[2022-01-10 00:00:00]

    prove next("* * * 10,20 * *", ~N[2000-01-01 00:00:00]) == ~N[2000-01-10 00:00:00]
    prove next("* * * 10,20 * *", ~N[2000-01-10 00:00:00]) == ~N[2000-01-10 00:00:01]
    prove next("* * * 10,20 * *", ~N[2000-01-11 00:00:00]) == ~N[2000-01-20 00:00:00]
    prove next("* * * 10,20 * *", ~N[2000-01-21 00:00:00]) == ~N[2000-02-10 00:00:00]
    prove next("* * * 10,20 * *", ~N[2000-12-21 00:00:00]) == ~N[2001-01-10 00:00:00]

    prove next("0 0 0 10,20 * *", ~N[2000-01-01 10:10:10]) == ~N[2000-01-10 00:00:00]
    prove next("0 0 0 10,20 * *", ~N[2000-01-10 10:10:10]) == ~N[2000-01-20 00:00:00]

    prove next("* * * 10 * MON", ~N[2021-01-09 23:00:00]) == ~N[2021-01-10 00:00:00]
    prove next("* * * 10 * MON", ~N[2021-01-10 23:59:59]) == ~N[2021-01-11 00:00:00]
    prove next("* * * 10 * MON", ~N[2021-01-12 00:00:00]) == ~N[2021-01-18 00:00:00]

    prove next("0 0 31 * *", ~N[2021-01-01 00:00:00]) == ~N[2021-01-31 00:00:00]
    prove next("0 0 31 * *", ~N[2021-01-31 00:00:00]) == ~N[2021-03-31 00:00:00]
    prove next("0 0 31 * *", ~N[2021-03-31 00:00:00]) == ~N[2021-05-31 00:00:00]

    prove next("* * * * 6 *", ~N[2021-01-05 09:10:00]) == ~N[2021-06-01 00:00:00]
    prove next("* * * * 6 *", ~N[2021-11-05 09:10:00]) == ~N[2022-06-01 00:00:00]

    prove next("0 0 0 08 08 *", ~N[2021-01-01 00:00:00]) == ~N[2021-08-08 00:00:00]
    prove next("0 0 0 08 08 *", ~N[2021-08-08 00:00:00]) == ~N[2022-08-08 00:00:00]

    prove next("0 0 0 10 10 TUE", ~N[2021-01-01 23:00:00]) == ~N[2021-10-05 00:00:00]

    prove next("0 0 0 1-7 * mon", ~N[2021-01-01 00:00:00]) == ~N[2021-01-02 00:00:00]
    prove next("0 0 0 1-7 * mon", ~N[2021-01-02 00:00:00]) == ~N[2021-01-03 00:00:00]
    prove next("0 0 0 1-7 * mon", ~N[2021-01-07 00:00:00]) == ~N[2021-01-11 00:00:00]

    prove next("0 0 0 * * mon", ~N[2021-01-01 00:00:00]) == ~N[2021-01-04 00:00:00]
    prove next("0 0 0 * * tue", ~N[2021-01-01 00:00:00]) == ~N[2021-01-05 00:00:00]
    prove next("0 0 0 * * wed", ~N[2021-01-01 00:00:00]) == ~N[2021-01-06 00:00:00]
    prove next("0 0 0 * * thu", ~N[2021-01-01 00:00:00]) == ~N[2021-01-07 00:00:00]
    prove next("0 0 0 * * fri", ~N[2021-01-01 00:00:00]) == ~N[2021-01-08 00:00:00]
    prove next("0 0 0 * * sat", ~N[2021-01-01 00:00:00]) == ~N[2021-01-02 00:00:00]
    prove next("0 0 0 * * sun", ~N[2021-01-01 00:00:00]) == ~N[2021-01-03 00:00:00]

    prove next("0 0 0 * * mon-fri", ~N[2021-01-01 00:00:00]) == ~N[2021-01-04 00:00:00]
    prove next("0 0 0 * * mon-fri", ~N[2021-01-04 00:00:00]) == ~N[2021-01-05 00:00:00]
    prove next("0 0 0 * * mon-fri", ~N[2021-01-08 00:00:00]) == ~N[2021-01-11 00:00:00]
    prove next("0 0 0 * * mon-fri", ~N[2021-01-10 00:00:00]) == ~N[2021-01-11 00:00:00]

    prove next("0 0 0 * * mon,fri", ~N[2021-01-01 00:00:00]) == ~N[2021-01-04 00:00:00]
    prove next("0 0 0 * * mon,fri", ~N[2021-01-04 00:00:00]) == ~N[2021-01-08 00:00:00]

    prove next("0 0 0 * * */2", ~N[2022-01-01 00:00:00]) == ~N[2022-01-02 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-02 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-03 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-04 00:00:00]) == ~N[2022-01-06 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-05 00:00:00]) == ~N[2022-01-06 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-06 00:00:00]) == ~N[2022-01-08 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-07 00:00:00]) == ~N[2022-01-08 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-08 00:00:00]) == ~N[2022-01-09 00:00:00]
    prove next("0 0 0 * * */2", ~N[2022-01-09 00:00:00]) == ~N[2022-01-11 00:00:00]

    prove next("0 0 0 * * */4", ~N[2021-11-22 00:00:00]) == ~N[2021-11-25 00:00:00]
    prove next("0 0 0 * * */4", ~N[2021-11-25 00:00:00]) == ~N[2021-11-28 00:00:00]
    prove next("0 0 0 * * */4", ~N[2021-11-28 00:00:00]) == ~N[2021-12-02 00:00:00]
    prove next("0 0 0 * * */4", ~N[2021-12-02 00:00:00]) == ~N[2021-12-05 00:00:00]
    prove next("0 0 0 * * */4", ~N[2021-12-05 00:00:00]) == ~N[2021-12-09 00:00:00]

    prove next("0 0 0 * 1 tue/3", ~N[2021-12-31 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove next("0 0 0 * 1 tue/3", ~N[2022-01-04 00:00:00]) == ~N[2022-01-07 00:00:00]
    prove next("0 0 0 * 1 tue/3", ~N[2022-01-07 00:00:00]) == ~N[2022-01-11 00:00:00]
    prove next("0 0 0 * 1 tue/3", ~N[2022-01-11 00:00:00]) == ~N[2022-01-14 00:00:00]
    prove next("0 0 0 * 1 tue/3", ~N[2022-01-14 00:00:00]) == ~N[2022-01-18 00:00:00]

    prove next("0 0 0 * 1 mon-fri/2", ~N[2021-12-31 00:00:00]) == ~N[2022-01-03 00:00:00]

    prove next("0 0 0 1 * 0,6", ~N[2021-11-24 00:00:00]) == ~N[2021-11-27 00:00:00]
    prove next("0 0 0 1 * 0,6", ~N[2021-11-27 00:00:00]) == ~N[2021-11-28 00:00:00]
    prove next("0 0 0 1 * 0,6", ~N[2021-11-28 00:00:00]) == ~N[2021-12-01 00:00:00]

    prove next("0 0 0 29 2 *", ~N[2020-01-01 00:00:00]) == ~N[2020-02-29 00:00:00]
    prove next("0 0 0 29 2 *", ~N[2020-02-29 00:00:00]) == ~N[2024-02-29 00:00:00]
    prove next("0 0 0 29 2 sun", ~N[2020-02-29 00:00:00]) == ~N[2021-02-07 00:00:00]

    prove next("15 30 12 5 7 *", ~N[2022-07-05 12:30:15]) == ~N[2023-07-05 12:30:15]
    prove next("15 30 12 5 * *", ~N[2022-07-05 12:30:15]) == ~N[2022-08-05 12:30:15]
    prove next("15 30 12 * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-06 12:30:15]
    prove next("15 30 * * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-05 13:30:15]
    prove next("15 * * * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-05 12:31:15]

    prove next("26 26 23 4 4 *", ~N[2000-01-01 00:00:00Z]) == ~N[2000-04-04 23:26:26]
    prove next("26 26 23 4 4 *", ~N[2000-04-04 23:26:26Z]) == ~N[2001-04-04 23:26:26]
  end

  batch "previous/2" do
    prove previous("* * * * * *", ~N[2021-11-07 09:10:05]) == ~N[2021-11-07 09:10:04]
    prove previous("* * * * * *", ~N[2000-01-01 00:00:00]) == ~N[1999-12-31 23:59:59]

    prove previous("0 10 * * * *", ~N[2022-01-01 00:30:00]) == ~N[2022-01-01 00:10:00]
    prove previous("0 10 * * * *", ~N[2022-01-01 00:10:00]) == ~N[2021-12-31 23:10:00]

    prove previous("0 15,40 * * * *", ~N[2021-11-05 09:10:00]) == ~N[2021-11-05 08:40:00]
    prove previous("0 15,40 * * * *", ~N[2021-11-05 08:40:00]) == ~N[2021-11-05 08:15:00]
    prove previous("0 15,40 * * * *", ~N[2021-11-05 08:39:00]) == ~N[2021-11-05 08:15:00]
    prove previous("0 15,40 * * * *", ~N[2000-01-01 00:00:00]) == ~N[1999-12-31 23:40:00]

    prove previous("0 40,15 * * * *", ~N[2021-11-05 09:10:00]) == ~N[2021-11-05 08:40:00]
    prove previous("0 40,15 * * * *", ~N[2021-11-05 08:40:00]) == ~N[2021-11-05 08:15:00]
    prove previous("0 40,15 * * * *", ~N[2021-11-05 08:39:00]) == ~N[2021-11-05 08:15:00]
    prove previous("0 40,15 * * * *", ~N[2000-01-01 00:00:00]) == ~N[1999-12-31 23:40:00]

    prove previous("0 15-20,10 * * * *", ~N[2001-01-01 12:00:00]) == ~N[2001-01-01 11:20:00]
    prove previous("0 15-20,10 * * * *", ~N[2001-01-01 11:20:00]) == ~N[2001-01-01 11:19:00]
    prove previous("0 15-20,10 * * * *", ~N[2001-01-01 11:15:00]) == ~N[2001-01-01 11:10:00]
    prove previous("0 15-20,10 * * * *", ~N[2001-01-01 11:10:00]) == ~N[2001-01-01 10:20:00]
    prove previous("0 15-20,10 * * * *", ~N[2001-01-01 00:00:59]) == ~N[2000-12-31 23:20:00]

    prove previous("0 15-20,20/2,1-15/3 * * * *", ~N[2000-01-01 00:00:00]) ==
            ~N[1999-12-31 23:58:00]

    prove previous("0 15-20,1-15/3,*/4 * * * *", ~N[2021-11-05 23:55:00]) ==
            ~N[2021-11-05 23:52:00]

    prove previous("0 */3 * * * *", ~N[2021-11-05 12:00:00]) == ~N[2021-11-05 11:57:00]
    prove previous("0 */3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 12:00:00]
    prove previous("0 */3 * * * *", ~N[2021-11-05 12:03:00]) == ~N[2021-11-05 12:00:00]
    prove previous("0 */3 * * * *", ~N[2021-11-05 12:04:00]) == ~N[2021-11-05 12:03:00]

    prove previous("0 20-30/3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 11:29:00]
    prove previous("0 20-30/3 * * * *", ~N[2021-11-05 12:20:00]) == ~N[2021-11-05 11:29:00]
    prove previous("0 20-30/3 * * * *", ~N[2021-11-05 12:21:00]) == ~N[2021-11-05 12:20:00]
    prove previous("0 20-30/3 * * * *", ~N[2021-11-05 12:24:00]) == ~N[2021-11-05 12:23:00]

    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:01:00]) == ~N[2021-11-05 11:59:00]
    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:03:00]) == ~N[2021-11-05 12:02:00]
    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:05:00]) == ~N[2021-11-05 12:02:00]
    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:07:00]) == ~N[2021-11-05 12:05:00]
    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:08:00]) == ~N[2021-11-05 12:05:00]
    prove previous("0 2/3 * * * *", ~N[2021-11-05 12:59:59]) == ~N[2021-11-05 12:59:00]

    prove previous("0 10-20 * * * *", ~N[2021-11-05 11:01:00]) == ~N[2021-11-05 10:20:00]
    prove previous("0 10-20 * * * *", ~N[2021-11-05 11:10:00]) == ~N[2021-11-05 10:20:00]
    prove previous("0 10-20 * * * *", ~N[2021-11-05 11:10:01]) == ~N[2021-11-05 11:10:00]
    prove previous("0 10-20 * * * *", ~N[2021-11-05 11:12:00]) == ~N[2021-11-05 11:11:00]

    prove previous("* * 10 * * *", ~N[2021-11-07 09:05:00]) == ~N[2021-11-06 10:59:59]
    prove previous("* * 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-07 10:09:59]
    prove previous("* * 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-07 10:59:59]

    prove previous("0 * 10 * * *", ~N[2021-11-07 09:10:00]) == ~N[2021-11-06 10:59:00]
    prove previous("0 * 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-07 10:09:00]
    prove previous("0 * 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-07 10:59:00]

    prove previous("0 0 10 * * *", ~N[2021-11-07 09:10:00]) == ~N[2021-11-06 10:00:00]
    prove previous("0 0 10 * * *", ~N[2021-11-07 10:10:00]) == ~N[2021-11-07 10:00:00]
    prove previous("0 0 10 * * *", ~N[2021-11-07 23:59:59]) == ~N[2021-11-07 10:00:00]

    prove previous("* * * 10 * *", ~N[2021-11-01 23:00:00]) == ~N[2021-10-10 23:59:59]
    prove previous("* * * 10 * *", ~N[2021-11-11 23:00:00]) == ~N[2021-11-10 23:59:59]

    prove previous("* * * 10,20 * *", ~N[2000-01-01 00:00:00]) == ~N[1999-12-20 23:59:59]
    prove previous("* * * 10,20 * *", ~N[2000-01-31 00:00:00]) == ~N[2000-01-20 23:59:59]
    prove previous("* * * 10,20 * *", ~N[2000-01-20 23:59:59]) == ~N[2000-01-20 23:59:58]
    prove previous("* * * 10,20 * *", ~N[2000-01-19 23:59:59]) == ~N[2000-01-10 23:59:59]

    prove previous("0 0 0 10,20 * *", ~N[2000-01-01 10:10:10]) == ~N[1999-12-20 00:00:00]
    prove previous("0 0 0 10,20 * *", ~N[2000-01-10 10:10:10]) == ~N[2000-01-10 00:00:00]

    prove previous("* * * 10 * MON", ~N[2021-01-09 23:00:00]) == ~N[2021-01-04 23:59:59]

    prove previous("* * * * 6 *", ~N[2021-01-05 09:10:00]) == ~N[2020-06-30 23:59:59]
    prove previous("* * * * 6 *", ~N[2021-11-05 09:10:00]) == ~N[2021-06-30 23:59:59]

    prove previous("* * * * 7 *", ~N[2021-01-05 09:10:00]) == ~N[2020-07-31 23:59:59]
    prove previous("* * * * 7 *", ~N[2021-11-05 09:10:00]) == ~N[2021-07-31 23:59:59]

    prove previous("* * * * 2 *", ~N[2021-01-05 09:10:00]) == ~N[2020-02-29 23:59:59]
    prove previous("* * * * 2 *", ~N[2021-11-05 09:10:00]) == ~N[2021-02-28 23:59:59]

    prove previous("0 0 0 08 08 *", ~N[2021-01-01 00:00:00]) == ~N[2020-08-08 00:00:00]
    prove previous("0 0 0 08 08 *", ~N[2021-08-08 00:00:00]) == ~N[2020-08-08 00:00:00]
    prove previous("0 0 0 08 08 *", ~N[2021-08-08 00:00:01]) == ~N[2021-08-08 00:00:00]

    prove previous("0 0 0 10 10 TUE", ~N[2021-10-01 23:00:00]) == ~N[2020-10-27 00:00:00]

    prove previous("0 0 0 1-7 * mon", ~N[2021-01-01 00:00:00]) == ~N[2020-12-28 00:00:00]
    prove previous("0 0 0 1-7 * mon", ~N[2021-01-05 00:00:00]) == ~N[2021-01-04 00:00:00]
    prove previous("0 0 0 1-7 * mon", ~N[2021-01-09 00:00:00]) == ~N[2021-01-07 00:00:00]

    prove previous("0 0 0 * * mon", ~N[2021-01-01 00:00:00]) == ~N[2020-12-28 00:00:00]
    prove previous("0 0 0 * * tue", ~N[2021-01-01 00:00:00]) == ~N[2020-12-29 00:00:00]
    prove previous("0 0 0 * * wed", ~N[2021-01-01 00:00:00]) == ~N[2020-12-30 00:00:00]
    prove previous("0 0 0 * * thu", ~N[2021-01-01 00:00:00]) == ~N[2020-12-31 00:00:00]
    prove previous("0 0 0 * * fri", ~N[2021-01-01 00:00:00]) == ~N[2020-12-25 00:00:00]
    prove previous("0 0 0 * * sat", ~N[2021-01-01 00:00:00]) == ~N[2020-12-26 00:00:00]
    prove previous("0 0 0 * * sun", ~N[2021-01-01 00:00:00]) == ~N[2020-12-27 00:00:00]

    prove previous("0 0 0 * * mon-fri", ~N[2021-01-01 00:00:00]) == ~N[2020-12-31 00:00:00]
    prove previous("0 0 0 * * mon-fri", ~N[2021-01-04 00:00:00]) == ~N[2021-01-01 00:00:00]
    prove previous("0 0 0 * * mon-fri", ~N[2021-01-08 00:00:00]) == ~N[2021-01-07 00:00:00]
    prove previous("0 0 0 * * mon-fri", ~N[2021-01-10 00:00:00]) == ~N[2021-01-08 00:00:00]

    prove previous("0 0 0 * * mon,fri", ~N[2021-01-01 00:00:00]) == ~N[2020-12-28 00:00:00]
    prove previous("0 0 0 * * mon,fri", ~N[2021-01-04 00:00:00]) == ~N[2021-01-01 00:00:00]

    prove previous("0 0 0 * * */2", ~N[2022-01-01 00:00:00]) == ~N[2021-12-30 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-02 00:00:00]) == ~N[2022-01-01 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-03 00:00:00]) == ~N[2022-01-02 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-04 00:00:00]) == ~N[2022-01-02 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-05 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-06 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-07 00:00:00]) == ~N[2022-01-06 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-08 00:00:00]) == ~N[2022-01-06 00:00:00]
    prove previous("0 0 0 * * */2", ~N[2022-01-09 00:00:00]) == ~N[2022-01-08 00:00:00]

    prove previous("0 0 0 * 1 tue/3", ~N[2021-12-31 00:00:00]) == ~N[2021-01-29 00:00:00]
    prove previous("0 0 0 * 1 tue/3", ~N[2022-01-04 00:00:00]) == ~N[2021-01-29 00:00:00]
    prove previous("0 0 0 * 1 tue/3", ~N[2022-01-07 00:00:00]) == ~N[2022-01-04 00:00:00]
    prove previous("0 0 0 * 1 tue/3", ~N[2022-01-11 00:00:00]) == ~N[2022-01-07 00:00:00]
    prove previous("0 0 0 * 1 tue/3", ~N[2022-01-14 00:00:00]) == ~N[2022-01-11 00:00:00]

    prove previous("0 0 0 * 1 mon-fri/2", ~N[2021-12-31 00:00:00]) == ~N[2021-01-29 00:00:00]

    prove previous("0 0 0 29 2 *", ~N[2020-01-01 00:00:00]) == ~N[2016-02-29 00:00:00]
    prove previous("0 0 0 29 2 *", ~N[2020-02-29 00:00:00]) == ~N[2016-02-29 00:00:00]
    prove previous("0 0 0 29 2 sun", ~N[2020-02-29 00:00:00]) == ~N[2020-02-23 00:00:00]

    prove previous("15 30 12 5 7 *", ~N[2022-07-05 12:30:15]) == ~N[2021-07-05 12:30:15]
    prove previous("15 30 12 5 * *", ~N[2022-07-05 12:30:15]) == ~N[2022-06-05 12:30:15]
    prove previous("15 30 12 * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-04 12:30:15]
    prove previous("15 30 * * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-05 11:30:15]
    prove previous("15 * * * * *", ~N[2022-07-05 12:30:15]) == ~N[2022-07-05 12:29:15]
  end

  defp next(cron, datetime), do: Calc.next(datetime, Cron.new!(cron))

  defp previous(cron, datetime), do: Calc.previous(datetime, Cron.new!(cron))
end
